# Simple workflow for deploying static content to GitHub Pages
name: Build and Upload to S3

on:
  # Runs on pushes targeting the default branch
  #push:
  #  branches: ["main"]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:


jobs:
  # Single deploy job since we're just deploying
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Create site content
        run: |
          python ./helpers/create_pbom_release.py --source content/oscar/ --dest .
          tar cvzf pbom_data.tar.gz pbom_data/
      - name: Install AWS CLI
        run: |
          sudo apt-get update
          sudo apt-get install -y awscli

     
      - uses: shallwefootball/s3-upload-action@master
        name: Upload S3
        id: S3
        with:
          aws_key_id: ${{ secrets.AWS_KEY }}
          aws_secret_access_key: ${{ secrets.AWS_SECRET}}
          aws_bucket: pbomdata
          source_dir: 'pbom_data/pbom_data.tar.gz'
      

